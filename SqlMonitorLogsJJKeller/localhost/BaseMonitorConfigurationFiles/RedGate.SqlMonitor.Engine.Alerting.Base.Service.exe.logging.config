<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <configSections>
    <section name="log4net"
      type="log4net.Config.Log4NetConfigurationSectionHandler" />
  </configSections>
  <log4net>
    <renderer renderingClass="RedGate.SqlMonitor.Common.Utilities.Logging.ExceptionObjectLogger, RedGate.SqlMonitor.Common.Utilities" renderedClass="System.Exception" />
    <appender name="Console" type="log4net.Appender.ConsoleAppender">
      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%utcdate [%thread] %level %logger - %message%newline" />
      </layout>
    </appender>

    <appender name="RollingFile" type="log4net.Appender.RollingFileAppender">
      <file type="log4net.Util.PatternString">
        <converter>
          <name value="folder" />
          <type value="RedGate.SqlMonitor.Common.Utilities.Logging.CommonApplicationDataFolderPatternConverter, RedGate.SqlMonitor.Common.Utilities" />
        </converter>
        <converter>
          <name value="appname" />
          <type value="RedGate.SqlMonitor.Common.Utilities.Logging.AppNamePatternConverter, RedGate.SqlMonitor.Common.Utilities" />
        </converter>
        <conversionPattern value="%folder\Red Gate\Logs\%appname\Base Monitor.log" />
      </file>
      <appendToFile value="false" />
      <rollingStyle value="Size" />
      <maxSizeRollBackups value="20" />
      <maximumFileSize value="10MB" />
      <countDirection value="1" />
      <staticLogFileName value="True" />
      <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
      <immediateFlush value="true" />
      <layout type="RedGate.SqlMonitor.Common.Utilities.Logging.CustomLogHeaderLayout, RedGate.SqlMonitor.Common.Utilities">
        <conversionPattern value="%utcdate [%15thread] %-5level %30logger - %message%newline" />
      </layout>
    </appender>

    <appender name="SqlRollingFile" type="log4net.Appender.RollingFileAppender">
      <file type="log4net.Util.PatternString">
        <converter>
          <name value="folder" />
          <type value="RedGate.SqlMonitor.Common.Utilities.Logging.CommonApplicationDataFolderPatternConverter, RedGate.SqlMonitor.Common.Utilities" />
        </converter>
        <converter>
          <name value="appname" />
          <type value="RedGate.SqlMonitor.Common.Utilities.Logging.AppNamePatternConverter, RedGate.SqlMonitor.Common.Utilities" />
        </converter>
        <conversionPattern value="%folder\Red Gate\Logs\%appname\Base Monitor_ME Sql.log" />
      </file>
      <appendToFile value="false" />
      <rollingStyle value="Size" />
      <maxSizeRollBackups value="5" />
      <maximumFileSize value="10MB" />
      <countDirection value="1" />
      <staticLogFileName value="True" />
      <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
      <immediateFlush value="true" />
      <layout type="RedGate.SqlMonitor.Common.Utilities.Logging.CustomLogHeaderLayout, RedGate.SqlMonitor.Common.Utilities">
        <conversionPattern value="%utcdate [%15thread] %-5level %30logger - %message%newline" />
      </layout>
    </appender>

    <appender name="RepositorySqlRollingFile" type="log4net.Appender.RollingFileAppender">
      <file type="log4net.Util.PatternString">
        <converter>
          <name value="folder" />
          <type value="RedGate.SqlMonitor.Common.Utilities.Logging.CommonApplicationDataFolderPatternConverter, RedGate.SqlMonitor.Common.Utilities" />
        </converter>
        <converter>
          <name value="appname" />
          <type value="RedGate.SqlMonitor.Common.Utilities.Logging.AppNamePatternConverter, RedGate.SqlMonitor.Common.Utilities" />
        </converter>
        <conversionPattern value="%folder\Red Gate\Logs\%appname\Base Monitor_Repository Sql.log" />
      </file>
      <appendToFile value="false" />
      <rollingStyle value="Size" />
      <maxSizeRollBackups value="5" />
      <maximumFileSize value="10MB" />
      <countDirection value="1" />
      <staticLogFileName value="True" />
      <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
      <immediateFlush value="true" />
      <layout type="RedGate.SqlMonitor.Common.Utilities.Logging.CustomLogHeaderLayout, RedGate.SqlMonitor.Common.Utilities">
        <conversionPattern value="%utcdate [%15thread] %-5level %30logger - %message%newline" />
      </layout>
    </appender>

    <appender name="StatusLoggerRollingFile" type="log4net.Appender.RollingFileAppender">
      <file type="log4net.Util.PatternString">
        <converter>
          <name value="folder" />
          <type value="RedGate.SqlMonitor.Common.Utilities.Logging.CommonApplicationDataFolderPatternConverter, RedGate.SqlMonitor.Common.Utilities" />
        </converter>
        <converter>
          <name value="appname" />
          <type value="RedGate.SqlMonitor.Common.Utilities.Logging.AppNamePatternConverter, RedGate.SqlMonitor.Common.Utilities" />
        </converter>
        <conversionPattern value="%folder\Red Gate\Logs\%appname\Base Monitor_Sampling.log" />
      </file>
      <appendToFile value="false" />
      <rollingStyle value="Size" />
      <maxSizeRollBackups value="20" />
      <maximumFileSize value="10MB" />
      <countDirection value="1" />
      <staticLogFileName value="True" />
      <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
      <immediateFlush value="true" />
      <layout type="RedGate.SqlMonitor.Common.Utilities.Logging.CustomLogHeaderLayout, RedGate.SqlMonitor.Common.Utilities">
        <conversionPattern value="%utcdate [%15thread] %-5level %30logger - %message%newline" />
      </layout>
    </appender>

    <appender name="EventLogAppender" type="log4net.Appender.EventLogAppender" >
      <applicationName value="SQL Monitor 9" />
      <LogName value="Red Gate Software" />
      <threshold value="ERROR" />
      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%utcdate [%thread] %-5level %logger [%property{NDC}] - %message%newline" />
      </layout>
    </appender>

    <!--  Supported log levels are OFF, FATAL, ERROR, WARN, INFO, DEBUG and ALL -->
    <root>
      <level value="WARN" />
      <appender-ref ref="RollingFile" />
      <appender-ref ref="Console" />
      <appender-ref ref="EventLogAppender" />
    </root>
    <logger name="RedGate.SqlMonitor">
      <level value="WARN" />
    </logger>

    <!-- It's not recommended that you change any of the following logging settings unless advised to do so by Red Gate technical support staff. -->

    <!-- The threshold in milliseconds after which to log SQL -->
    <property>
      <key value="SqlCommandThreshold" />
      <value value="2000" />
    </property>

    <property>
      <key value="RepositorySqlCommandThreshold" />
      <value value="2000" />
    </property>

    <logger name="RedGate.SqlMonitor.Common.Utilities.Sql.Abstraction.SqlConnectionProvider" additivity="false">
      <level value="INFO" />
      <appender-ref ref="SqlRollingFile" />
    </logger>

    <logger name="RedGate.SqlMonitor.Common.Utilities.Sql.Abstraction.RepositorySqlConnectionProvider" additivity="false">
      <level value="INFO" />
      <appender-ref ref="RepositorySqlRollingFile" />
    </logger>

    <logger name="RedGate.SqlMonitor.Common.Utilities.Status.StatusLogger" additivity="false">
      <level value="INFO" />
      <appender-ref ref="Console" />
      <appender-ref ref="StatusLoggerRollingFile" />
    </logger>

    <!--
      Disables detailed logging of purge statistics. Detailed purge logging can be a bit spammy, so the levels are set to WARN by default to disable
      the logging of purge statistics and only show errors. To enable logging of detailed statistics, change the levels from WARN to INFO.
    -->
    <logger name="RedGate.SqlMonitor.Common.Utilities.Sql.DbCommandChunker">
      <level value="WARN" />
    </logger>
    <logger name="RedGate.SqlMonitor.Common.Utilities.Sql.ForeignKeyCleaning.SqlForeignKeyCleaner">
      <level value="WARN" />
    </logger>

    <logger name="RedGate.SqlMonitor.Engine.Monitoring.Core.ConnectionMonitor">
      <level value="INFO" />
    </logger>
  </log4net>
</configuration>
